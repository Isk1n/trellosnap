// Generated by CoffeeScript 1.8.0
(function() {
  var Actions, CapturePartial, CaptureVisible;

  Actions = (function() {
    function Actions() {}

    Actions.bind_capture_visible = function(button) {
      return button.on("click", function() {
        return CaptureVisible.screenshot();
      });
    };

    Actions.bind_capture_partial = function(button) {
      return button.on("click", function() {
        return CapturePartial.screenshot();
      });
    };

    return Actions;

  })();

  jQuery(function() {
    if ($("#capture-visible").length) {
      Actions.bind_capture_visible($("#capture-visible"));
    }
    if ($("#capture-partial").length) {
      return Actions.bind_capture_partial($("#capture-partial"));
    }
  });

  CapturePartial = (function() {
    function CapturePartial() {}

    CapturePartial.screenshot = function() {
      return chrome.tabs.insertCSS(null, {
        file: "/assets/stylesheets/selection.css"
      }, (function(_this) {
        return function() {
          return chrome.tabs.executeScript(null, {
            file: "/assets/javascripts/vendor/jquery.min.js"
          }, function() {
            return chrome.tabs.executeScript(null, {
              file: "/assets/javascripts/selection.js"
            }, function() {
              return window.close();
            });
          });
        };
      })(this));
    };

    return CapturePartial;

  })();

  CaptureVisible = (function() {
    var edit_page_path, open_edit_tab, page_info;

    function CaptureVisible() {}

    edit_page_path = "/views/edit.html";

    CaptureVisible.screenshot = function() {
      return chrome.tabs.executeScript(null, {
        code: "document.URL"
      }, function(page_url) {
        return chrome.tabs.executeScript(null, {
          code: "var res = window.innerWidth + ' x ' + window.innerHeight; res"
        }, function(page_resolution) {
          return chrome.tabs.captureVisibleTab(void 0, {
            format: "png"
          }, function(image) {
            return open_edit_tab(image, page_info(page_url[0], page_resolution[0]));
          });
        });
      });
    };

    page_info = function(url, res) {
      return {
        url: url,
        resolution: res,
        retina: devicePixelRatio === 2 ? "yes" : "no",
        chrome_version: window.navigator.appVersion.match(/Chrome\/(.*?) /)[1]
      };
    };

    open_edit_tab = function(image, page_info) {
      console.log("open tab");
      return chrome.tabs.create({
        url: edit_page_path
      }, (function(_this) {
        return function(tab) {
          return chrome.tabs.sendMessage(tab.id, {
            image: image,
            page: page_info,
            screenshot: "visible"
          });
        };
      })(this));
    };

    return CaptureVisible;

  })();

}).call(this);
